\section{Standard theorems of group theory}

In order to evaluate how practical our definitions of groups, cosets and quotients were, we 
have started formalising some standard results of group theory. In this section,
we present three of them: Sylow theorems, Frobenius lemma and Cauchy-Frobenius lemma. 
Sylow theorems are central in group theory. Frobenius lemma gives a nice property
of the elements of a group of a given order. Finally Cauchy-Frobenius 
lemma, also called Burnside counting lemma, applies directly to 
enumeration problems. 
Our main source of inspiration for these proofs 
was some lecture notes
on group theory by Constantine~\cite{Const}.

\subsection{Sylow theorems}

The first Sylow theorem states the existence of a subgroup {\tt H} of {\tt K} of cardinal ${\tt p} ^n$,
for every prime ${\tt p}$ such that ${\tt card}({\tt K}) = {\tt p}^n s$ and $p$ does not divide {\tt s}.
Its formal statement is the following
\begin{lstlisting}
Definition sylow K p H := subgroup H K && card H == p ^ (logn p (card K)).

Theorem sylow1: forall K p, exists H, sylow K p H.
\end{lstlisting}
The first definition captures the property of {\tt H} being a {\tt p}-Sylow subgroup of {\tt K}.
The function {\tt logn} computes, if {\tt p} is prime, the maximum value of $i$ such that
${\tt p}^i$ divides the cardinality of {\tt K}, if {\tt p} is not prime it returns 0.
This theorem has already been formalised by Kammüller and Paulson~\cite{kam}.
They have followed the standard proof  due to Wielandt~\cite{Wielandt}.
Our proof is slightly different and intensively uses group actions on sets. 
Given a group domain \C{G} and a finite type \C{S}, actions are defined
by the following structure
\begin{lstlisting}
Structure action : Type := Action {
  act_f :> S -> G -> S;
  act_1 : forall x, act_f x 1 = x;
  act_morph : forall (x y : G) z, act_f z (x * y) = act_f (act_f z x) y 
}.
\end{lstlisting}
Note that we take advantage of our finite setting to replace the 
usual bijectivity of the action by the simpler property that
acting with the neutral element is the identity.

A complete account of our proof is given in~\cite{rt_sylow}.
The proof works by induction on $n$ showing that there exists a subgroup of order ${\tt p}^i$ for all
$0 < i \le n$. The base case is Cauchy theorem. It states the existence of an element of order
{\tt p} where {\tt p} is a prime divisor of the cardinality of the group {\tt K}. To prove it,
we use a simpler argument than the one in~\cite{kam} where a combinatorial argument 
based on some properties of the binomial is used. We first build the set $U$ such that  $ U = \{ (k_1, \dots, k_{\tt p}) \,\,|
\,\,
k_i \in {\tt K} \, \textrm{and}\, \prod_{i=1}^{i={\tt p}} k_i = 1\}$. We have that ${\it card}(U) = {\it card}({\tt K})^{{\tt p}-1}$.
We then define the action of the additive group $\mathbb{Z}/{\tt p}\mathbb{Z}$ that acts on $U$ as
$$ n \quad \longmapsto \quad (k_1,\dots, k_{\tt p}) \mapsto (k_{n \,{\tt mod}\, {\tt p} + 1},\dots, k_{(n + {\tt p} -1) \,{\tt mod}\, {\tt p} + 1})$$
Note that defining this action is straightforward since \C{p}-tuples are graphs of function
whose domain is \C{(ordinal p)}.

Now, we consider the set $S_0$ of the elements of $U$ whose orbits by the 
action are a singleton. $S_0$ is composed of the elements $(k,\dots,k)$ such that $k\in {\tt K}$ and $k^p=1$.
A consequence of the class equation tells  us that {\tt p} divides
the cardinal of $S_0$. As $S_0$ is non-empty ($(1,\dots,1)$ belongs to $S_0$), there
exists at least one $k\neq 1 $, such that $(k,\dots,k)$ belongs to $S_0$. The order of $k$ is then ${\tt p}$.

In a similar way, in the inductive case, we suppose that there is a subgroup {\tt H} of order ${\tt p}^i$,
we consider ${\it N_{\tt K}({\tt H})/{\tt H}}$ the quotient of the normaliser of {\tt H} in {\tt K} 
by {\tt H}. We act with {\tt H} on the left cosets
of {\tt H} by left translation:
$$ g \quad \longmapsto \quad h{\tt H} \mapsto (gh){\tt H} $$
and consider the set $S_0$ of the left coset of {\tt H} whose orbits by the 
action are a singleton. The elements of $S_0$ are exactly the elements of $N_{\tt K}({\tt H})/{\tt H}$.
Again, applying the class equation, we can deduce that {\tt p} divides the cardinal of $S_0$ so
there exists an element $k$ of order {\tt p} in $S_0$ by Cauchy theorem. If we consider  {\tt H'} the pre-image
by the quotient operation of the cyclic group generated by $k$, its cardinality is ${\tt p}^{i+1}$. 

We have also formalised the second and third Sylow theorems. The second theorem states that any
two {\tt p}-Sylow subgroups $H_1$ and $H_2$ are conjugate. This is proved
acting with $H_1$ on the left coset of $H_2$. The third theorem 
 states that the number of {\tt p}-Sylow subgroups divides the cardinality
of {\tt K} and is equal to 1 modulo $p$. The third theorem is proved by acting by 
conjugation on the sets of all {\tt p}-Sylow subgroups. 

\subsection{Frobenius lemma}

Given an element $a$ of a group $G$, \C{(cyclic $a$)} builds the
cyclic group generated by $a$. When proving properties of cyclic groups,
we use the characteristic property of the \C{cyclic} function.
\begin{lstlisting}[fontadjust]
Lemma cyclicP: forall a b, reflect (exists n, a^n == b) (cyclic a b). 
\end{lstlisting}
The order of an element is then defined as the cardinality of its associated cyclic
group. Frobenius lemma states that given a number $n$ that divides the cardinality of a 
group {\tt K}, the number of elements whose order divides $n$ is a multiple
of $n$. In our formalisation, this gives
\begin{lstlisting}
Theorem frobenius: forall K n, n | (card K)  ->   n | (card {z:K,  (orderg z) | n}).
\end{lstlisting}

The proof is rather technical and has intensively tested our library on cyclic groups.
For example, as we are counting the number of elements of a given order, we need
to know the number of generators of a cyclic group. This is given by a theorem of
our library
\begin{lstlisting}
Lemma phi_gen: forall a,phi (orderg a) = card (generator (cyclic a)).
\end{lstlisting}
where \C{phi} is the Euler function.

\subsection{The Cauchy-Frobenius lemma}


Let $G$ a group acting on a set $S$. For each $g$ in $G$, let $F_g$ be the set
of elements in $S$ fixed by $g$, and $t$ the number of orbits of $G$ on
$S$, then $t$ in equal to the average number of points left fixed by
each element of $G$:
$$ t = \frac {1} {|G|} \sum_{g\in G} |F_g|$$
\noindent
To prove this lemma, we consider B,  subset of the cartesian product $G \times S$ containing the  pairs $(g,x)$ such that  $g(x) = x$.
We use two ways to evaluate the cardinality of B, first  by fixing the first
component: 
$|B| = \sum_{g\in G}\vert F_g\vert$, then by fixing the second component:
$|B|=\sum_{ x\in S}\vert G_x\vert$ where $G_x$ is the stabiliser of $x$ in $G$.
Then, when sorting the right hand-side of the second equality by
orbits we obtain that 
$|B|=|G{x_1}||G_{x_1}| +|G{x_2}| |G_{x_2}| +\cdots +|G{x_t}| |G_{x_t}|$
the $x_i$ being representatives of the orbit $G{x_i}$.
Applying the Lagrange theorem on the stabiliser of  $x_i$ in G (the
subgroup $G_{x_i}$), we obtain that for each orbit:
$|G{x_i}| |G_{x_i}| = |G|$ and we deduce that  $|B|= t |G| = \sum_{g\in G} |F_g|$.

This lemma is a particular case of the powerful Pólya method, but it
already has significant applications in combinatorial counting problems. 
To illustrate this, we have formally shown that there are 55 distinct
ways of colouring with 4 colours  the vertices of a square up to isometry.  
This is done by instantiating a more general theorem that tells that the number of 
ways of colouring with $n$ colours
is \mbox {$(n^4 + 2n^3 + 3n^2 + 2n)/8$}. This last theorem is a direct application
of the Cauchy-Frobenius theorem. The encoding of the problem is
the following:
\begin{lstlisting}
 Definition square := ordinal 4.
 Definition colour := ordinal n.
 Definition colouring := fgraphType square colour.
\end{lstlisting}
Vertices are represented by the set $\{0,1,2,3\}$, colours 
by the set $\{0,1,\dots,n-1\}$ and colouring by functions
from vertices to colours. The set of isometries is a subset of the permutations
of {\tt square} that preserve the geometry of the square. In our case,
we use the characteristic condition that {\it the images of two opposite vertices
remain opposite}.
\begin{lstlisting}
 Definition isometry := {p : perm square, forall i, p (opp i) = opp (p i)}.
\end{lstlisting}
where % \lstinline[basicstyle=\footnotesize]+$\forall_f$+ is
% the decidable universal quantification on finite types,
\C{perm square} is the permutation group and
 \C{opp}  the function that returns the opposite of a vertex. 
We get that the isometries is a subgroup of the permutations,
since the property of conserving opposite vertices is stable
by composition and the identity obviously preserve opposite vertices.

Given $p$ an isometry, acting with $p$ is defined as
the function that given a colouring $c$ returns the colouring $i \mapsto c(p(i))$.
Each set of
identical coloured squares corresponds to an orbit of this
action. To apply Cauchy-Frobenius, we first need to give an extensional
definition of the isometries, i.e. there are 8 isometries: the identity, 
the 3 rotations of $\pi /2$, $\pi$ and $3\pi /2$, the vertical symmetry, 
the horizontal symmetry and the 2 symmetries about the diagonals.
Second, we have to count the elements left fixed by each of the isometry.

The proofs of three theorems presented in this section manipulate many
of the base concepts defined in  our formalisation. They have been particularly 
important to gave us feed-back on how practical our definitions were.
